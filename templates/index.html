<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Lead Finder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link rel="stylesheet" href="/static/styles.css"/>
</head>
<body>
  <div class="container">
    <h1>Lead Finder</h1>
    <p class="sub">Use either quick lookup (single company) or filtered lead search (bulk).</p>

    <!-- 1) QUICK LOOKUP -->
    <section class="card">
      <h2>Quick Lookup (Single Company)</h2>
      <p class="muted">Type a company name. We’ll search, scrape and export a JSON.</p>

      <form id="lead-form">
        <input id="query" type="text" placeholder="e.g., Taj Hotels" required />
        <button type="submit" class="btn primary">Find Lead</button>
      </form>

      <div id="status" class="status hidden">
        <div class="spinner"></div>
        <div class="msg">
          <div id="status-line">Starting…</div>
          <div class="tips" id="dynamic-tip"></div>
        </div>
      </div>

      <div id="result" class="result hidden"></div>
    </section>

    <!-- 2) FILTERED LEAD SEARCH -->
    <section class="card">
      <h2>Filtered Lead Search</h2>
      <p class="muted">Filter by industry, size, geography, and roles. Click <b>Search</b> to fetch leads. Download JSON when ready.</p>

      <div class="grid-2">
        <div>
          <label for="industry">Industry Focus</label>
          <select id="industry">
            <option>Hospitality & Travel</option>
            <option>Fintech</option>
            <option>Healthcare</option>
            <option>Pharmacy</option>
            <option>IT & SAAS</option>
          </select>
        </div>

        <div class="grid-2">
          <div>
            <label for="sizeMin">Company Size Min</label>
            <input id="sizeMin" type="number" value="50" />
          </div>
          <div>
            <label for="sizeMax">Company Size Max</label>
            <input id="sizeMax" type="number" value="5000" />
          </div>
        </div>
      </div>

      <label>Countries</label>
      <div class="multiselect" id="countriesMulti">
        <button type="button" class="select-toggle" id="countriesToggle">
          <span id="countriesSummary">Select countries</span>
          <svg width="16" height="16" viewBox="0 0 24 24"><path d="M7 10l5 5 5-5z" fill="currentColor"/></svg>
        </button>
        <div class="select-panel" id="countriesPanel" aria-hidden="true">
          <div class="check-grid">
            <label><input type="checkbox" value="India"> India</label>
            <label><input type="checkbox" value="United Kingdom"> United Kingdom</label>
            <label><input type="checkbox" value="Italy"> Italy</label>
            <label><input type="checkbox" value="Spain"> Spain</label>
            <label><input type="checkbox" value="Germany"> Germany</label>
            <label><input type="checkbox" value="Switzerland"> Switzerland</label>
          </div>
          <div class="actions">
            <button class="btn" type="button" id="countriesAllBtn">Select all</button>
            <button class="btn" type="button" id="countriesClearBtn">Clear</button>
            <button class="btn primary" type="button" id="countriesDoneBtn">Done</button>
          </div>
        </div>
      </div>

      <label for="roles">Target Roles</label>
      <input id="roles" value="CEO, COO, Head of Operations, General Manager, GM" />

      <div class="actions">
        <button id="searchBtn" class="btn primary">Search</button>
        <button id="resetBtn" class="btn">Reset</button>
      </div>
    </section>

    <section class="card" id="results" style="display:none;">
      <div id="meta"></div>
      <div id="download"></div>
      <div id="tableWrap"></div>
    </section>
  </div>

  <!-- Correct script -->
  <script src="/static/app.js"></script>

  <!-- Quick lookup logic -->
  <script>
    const leadForm = document.getElementById('lead-form');
    const statusBox = document.getElementById('status');
    const statusLine = document.getElementById('status-line');
    const resultBox = document.getElementById('result');
    const tipEl = document.getElementById("dynamic-tip");

    let tips = ["Searching Google…","Analyzing firmographics…","Fetching contacts…","Scraping LinkedIn roles…","Exporting JSON…"];
    let tipTimer = null;
    let tipIndex = 0;
    function startTips() {
      tipIndex = 0;
      tipEl.textContent = tips[tipIndex];
      tipTimer = setInterval(() => {
        tipIndex = (tipIndex + 1) % tips.length;
        tipEl.textContent = tips[tipIndex];
      }, 1200);
    }
    function stopTips() { clearInterval(tipTimer); tipTimer = null; }

    function show(el){ el.classList.remove('hidden'); }
    function hide(el){ el.classList.add('hidden'); }

    leadForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const query = document.getElementById('query').value.trim();
      if (!query) return;

      show(statusBox);
      hide(resultBox);
      statusLine.textContent = 'Working… please wait.';
      startTips();

      try {
        const res = await fetch('/api/run', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ query })
        });

        const data = await res.json();
        stopTips();
        hide(statusBox);

        if (!data.ok) {
          show(resultBox);
          resultBox.innerHTML = `<div>⚠️ ${data.error}</div>`;
          return;
        }

        show(resultBox);
        resultBox.innerHTML = `<div>✅ Done — <a href="${data.json_path}">Download JSON</a></div>`;
      } catch (err) {
        stopTips();
        hide(statusBox);
        show(resultBox);
        resultBox.innerHTML = `<div>⚠️ ${err.message}</div>`;
      }
    });
  </script>
</body>
</html>
